How to configure K8s Cluster

# hostnamectl set-hostname master-node
# cat <<EOF>> /etc/hosts
192.168.56.107 master-node
192.168.56.106 node-1 worker-node-1
192.168.56.108 node-2 worker-node-2
EOF

setenforce 0

sed -i --follow-symlinks 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux

comment swap entry in /etc/fstab in all nodes

"swapoff -a" in all nodes

modprobe br_netfilter

setup k8s repo on all nodes

cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF

init kubernetes Cluster

kubeadm init --pod-network-cid=10.244.0.0/16 --apiserver-advertise-address=master-server-ip

kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml

cat <<EOF > /data/config
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeU1ETXdNekUzTURRMU1Wb1hEVE15TURJeU9URTNNRFExTVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTnlRCkwyVy9Bd3dhVTYrZmNKUXB1QXEzbGtoZGswSjFwcUllWGZLdEd1Nk43aHg5M3BXV3FqWlFKUlRkaGJlY21MWXoKL0pkbVZyMDVOcXFpQ004SFdhWGtnelhPMzhQY3NNd1BpUVUwZHBIY2VTWVhCMTFHUE1UUGRJR3Q5TUhBbDEzdgpWZmY0c291NlJDbkxlZmpvN1JhcXZlN3haOFZ3TnkvZmREN0pCL1FIc0J2SHZDTGZUckJOdTMrcFFaekhiS0VwCkh1SjI0cHJyS2t6aDl5Rm41Q0ZSamxXdEdncEJ4OHZQc2FrKzlONUdPWlI3TXN6U2lhL3k1K2hTeUx6R3lJZVEKbHZZL0dDRHdrcEs4SU5idHVSUkVJN3FyZ0V0aVVhNnhiN1NyelNLNXo3cHoybWFMK2ZRVnRFS21LbU5NelRrSQpJUTRHL2YwK21HTEZEd29LV1RNQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZCakZiV3YraVFLbW1ETmpUS2xEZ1pXQ1llRG5NQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQkRtVFhkNDdMZ0gwdmV0emlTQQpmaVlEeit2NzJRcStnbHF4a0NhbUgxSlRENHExRG5TTW1tUW1YUFFqSVZxdCtSazgyRWducndLdm5weDlKcnZpCittQ0FIRXhveFpTZkpTdGtxOERYQnpnMGNZVFRUd0FzUDZsSHBrM3ZRQS9jdTVKV0JJWHRVaEtlVDhPREN5ZmUKYmxEeDAxTi8zem5FdnRTQTByRzA0c2xiaXRsN0dCbkcwMXBBOXpkTVlqOGU1K1dTdWc5TGRBMHdSc0Rxa1lSNApSRzcrM05jcitrT2JBR0lYK1JSdmxibGNDZkZtbDV6L2I0NlNPTjM1WkJYdWg4RkVkVHB6K1hUVit5OU9LK3ZLCnVoSkVkcWRRY1dveGFYdmlIZzVzbGtFNStOMGFhc2NqcXdQaGs4cWZXVkdMcEZBMTlacGpmWWZad05aMmRKc3gKR1lnPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    server: https://192.168.56.107:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJVEhUUGY5T2FzeDR3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TWpBek1ETXhOekEwTlRGYUZ3MHlNekF6TURNeE56QTBOVFJhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXpKcm9ZR1ZlU2xwWGdJM0IKMEtCdEczenZ4a2UxQktpcm1BaWtpOHozTEhGOUdIa1NjV0ZuVkN6ejlsekgwVFY4Ym5KVmptOFBNbklXWFNaVwpVS1ZwSGpEWHhQZ0FTeHhWWnpBWU43NDdZLzVuNXBnZFFROVpBdisrNHV5UFhhVjB6dVRSYWpCNmJZWENXRnE4CnJCbDdmU3REdExlYmI0cFkxMUZNeDJiTUxXSjYyMWFsLzVaV2p1SXVsOEZYMW5oU2RmQW5YSzhEZ1NyZWpVcjIKTXpFNGNDdjc4YVpDRFVtUTV1YlF3TFVCckRObHgvdERCemxOZTE4dUg4RDI2T21DRzFFRUxWU3pvTXpPOCtsMgpBbTVWTHM2Q24yS1dqckprVExReUxCMk1PZm9IbjhLdXJhWjY1eGdwempwS3dRaW1sUTVoMHQ1YTlsMGZqVE05Cm9lQ0lWUUlEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JRWXhXMXIvb2tDcHBnelkweXBRNEdWZ21IZwo1ekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBVE9YbGdTbnZTcjc3WjZ2SjJodENnSlV4RTJRK2ZyOVJBd09RCnpSU0tlb3B3NDYrNTJyTm9rT016ZTRzS2M3bS8yenF6UWNMeUxNdy9vbWo1bWtlZlU2Q1pFMmQ0dmJPTm4rMkIKUlRXVXhPTnRCblBXWUJERVRmUjZHR29WQ0Z1QWlibXhSV2g5emZ4TzB6c3p0NDFPekE2d2lIejlkaWJmaGh4cApaczZYNkxkMys1V2NvYjlSK2U3VUJ2TDhwaHlmRUM5TkJjVWJueG1uTFRJWUV2UW9tOUphd3NCdTNIdUJocGlWCmQ5VEpmNGlZL0RtbXc0b1BVcUdKaWFBdEsyQ0lVT3F6ckRIM2JvNmMxTmpJeWtrMldHT1lHbkFLVzhPWGEzRysKTzlMSVFPMVE5UWxlZTV5R2dqM08yV1pVQTRFTThHMzZVbmNYTm5FdWtCN2FKaEZEQUE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBekpyb1lHVmVTbHBYZ0kzQjBLQnRHM3p2eGtlMUJLaXJtQWlraTh6M0xIRjlHSGtTCmNXRm5WQ3p6OWx6SDBUVjhibkpWam04UE1uSVdYU1pXVUtWcEhqRFh4UGdBU3h4Vlp6QVlONzQ3WS81bjVwZ2QKUVE5WkF2Kys0dXlQWGFWMHp1VFJhakI2YllYQ1dGcThyQmw3ZlN0RHRMZWJiNHBZMTFGTXgyYk1MV0o2MjFhbAovNVpXanVJdWw4RlgxbmhTZGZBblhLOERnU3JlalVyMk16RTRjQ3Y3OGFaQ0RVbVE1dWJRd0xVQnJETmx4L3RECkJ6bE5lMTh1SDhEMjZPbUNHMUVFTFZTem9Nek84K2wyQW01VkxzNkNuMktXanJKa1RMUXlMQjJNT2ZvSG44S3UKcmFaNjV4Z3B6anBLd1FpbWxRNWgwdDVhOWwwZmpUTTlvZUNJVlFJREFRQUJBb0lCQUg0U1hXazRUTmRIdjI4SQo2Z25oTUJtbDdDQ2pBcGt5VFRsSzZnanliTU5IMHFzSHZ5TjV2eStRMjJwTVZSdEY5N3dlV3pWK25VQ2FKOG1SCjI5R3BlcElOeW9ZbHdoaUdCdUdrTXVmMklhWkZsa1B5S3VSeHpva1lpTWhPdHpBZXlWREtrWGI3RkJUMFBJSXcKdHR6Y2ZzanJwYlp2QkNuQWQybUZRT2dGSVg0OGZCd3ZKMkxweUZtYnQ5SHpaTFptUWF2SEpuKys1R2tTVW1QSAo1Z3dtOXpTNWY5ODIreTlLekdYMDRXSENmTmEvQ0J0YjBma0VLSk1ZOUhLellYaVFNb0lCTDY4UTBUMHo2czR4CnZXV3Vic2dIeWhIb2JUeERtVnFEZGkyUWpQckp1bVl3dmwzSEFNTnhSSDZFMVRJTkwxRWVxbkppMDgydDVYQ1IKLzAyVzVpa0NnWUVBNEwrSVVqckZpU2ZuNDMrTHJUejFqamU2dW81WkwzaGdCRlgzSnYwaFdxRVlONVJGTkRPUAp5SHA1SXUzSkZkNkdya05uN0NZbHQ3ZUU4aEhxbzg5NVRHYThPSWJncWF2WlQ1b2pjYU5oQWtvYlk0VTlvYWhwCi9pYkJTaXNwc201dWthdmlDV2cxS1hIZmo0b0ZHQ3JpclIrc0tKVWh4S3lYNUZXRmJXK2ZUNjhDZ1lFQTZRNVYKTzg0ajBONFNBYXhONnI1Y3ZmZDdBVkkyYUs2a0FmT0JpeG1IS3B0bitnUjAyeVZSU1FWZzkxdUpwOXlwZHpVNwpPYUxsOU1rYXdxNVQrTGx5eHQxeWc0RnRlMkhlVDVubVp0Qm5FeTNLUDBoN2p4OGF1Mk5NQmFDNlJiamp2SXlqCmQxN0tzMzBMTm1WZUVFV1NTQ0VZSi9jL0drWEF6SjNKTE5nQlJUc0NnWUVBbVhadlVTYk1aMkVXV0NOcGJydG4KT05zWTUvWDNOQkRRRDJYYnc0V28xc2VWVDY0d3F2cGlQWlJUVHVScklFRzRXUm14eG5BdDVRcXMvdFg1RUMzRgpOOFFXMWNwVGNjZmtOUlNkQ3lWeVFpdjBFN3FSWU9jc3FOd3hzOEZSVVlOU2dLbUxTTDBkUDlWL3YvV1FrUFlICm5nczRkT1dRRDBtQzFla0htTGhWWWdVQ2dZRUF2SE9zbEZtU09KajVzb1NqMU1mdHNtYmwvaUYrZ1pPR1oxV0MKVVBwcGhCaDZNWDlkQnIvY1JOR21vUjVSNTN6VlErRzFiRnUrMnZ1ck9mVkJUWVNYdlJyZ09GcDJMeWpxWFMregpVVHYvdlZCdmxGQ0dLU3Nic0o4UW9CUmh5M05BSS8wTlNiOUs1V3lkbm5URlpSNzh0SHFlVCtMc0VkQ0pvR3VPCmUwYUhjSFVDZ1lFQXhuUFZKZVY3MHZEMmE4ZFhmdEJTQVg0NWV2dXNiM1k0aEdLUUlQVzV4T2hRVTlVeG1pTzIKTUErS0hIRUNMc1BxbG9LMmc3ZmZYeTZjbWViM0FTYjFNZzZCSTV5K1BxK0xDTkFvNnlqdjdzUHpmOHpmb0VQTgpuRG9sV2MwSHZTZHJMRzhEd3BKa2lacWtpSTNYUmFKVjVIaHhXcTV3UmxJRmFhbVBoc2JoNjVzPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
EOF